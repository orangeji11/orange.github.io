# 有雀搭建
## 创建安装配置
1. 创建安装配置install-config.yaml文件如下：
```yaml
apiVersion: v1
baseDomain: jzy.com
compute:
- architecture: amd64
  hyperthreading: Enabled
  name: worker
  platform:
    openstack:
      zones: ['nova']
      type: uccps.small
  replicas: 2
controlPlane:
  architecture: amd64
  hyperthreading: Enabled
  name: master
  platform:
    openstack:
      zones: ['nova']
      type: uccps.middle
  replicas: 3
metadata:
  creationTimestamp: null
  name: uccps-ns
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  machineNetwork:
  - cidr: 10.67.0.0/16
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
platform:
  openstack:
    apiFloatingIP: 10.10.15.120
    apiVIP: 10.67.0.5
    cloud: openstack
    clusterOSImage: uswift-20230203-uccps-x86_64
    defaultMachinePlatform:
      type: 8-32-120
    externalDNS: ['10.10.15.81']
    externalNetwork: provider
    ingressVIP: 10.67.0.7
    ingressFloatingIP: 10.10.15.31
publish: External
pullSecret: '***'
sshKey: '***'
```
2. 添加环境变量  
```shell
echo $OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE
10.10.15.73/utccp-amd64/release:latest
```
3. 创建manifests并添加私库信任到目录
```shell
[root@controller uccps-ns]# ./utccp-install create manifests
INFO Credentials loaded from file "/home/jzy/uccps-ns/clouds.yaml" 
INFO Consuming Install Config from target directory 
INFO Manifests created in: manifests and openshift 
[root@controller uccps-ns]# cp ../cluster-image.yaml manifests/
```
cluster-image.yaml:
```yaml

```
4. 执行创建命令
5. 连接到引导节点添加免密
```shell
sudo vi /etc/containers/registries.conf
[[registry]]
  prefix = ""
  location = "10.10.15.73"
  insecure = true
```
重启日志服务快速查看日志
```shell
sudo systemctl restart systemd-journald
```

有问题的组件：
+ uccps-ingress
+ uccps-ingress-operator
+ uccps-etcd
+ uccps-dns
+ uccps-controller-manager-operator
+ uccps-apiserver

